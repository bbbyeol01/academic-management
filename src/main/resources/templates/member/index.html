<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="/layout/basic :: head">
</head>
<style type="text/css">
    a {
        color: #000000;
        text-decoration: none;
    }

    .scriptCalendar {
        text-align: center;
    }

    .scriptCalendar > thead > tr > td {
        width: 50px;
        height: 30px;
    }

    .scriptCalendar > thead > tr:first-child > td {
        font-weight: bold;
        border: 1px solid rgba(0, 0, 0, 0.25);
    }

    .scriptCalendar > thead > tr:last-child > td {
        width: 50px;
        height: 30px;
        font-weight: bold;
        border: 1px solid rgba(0, 0, 0, 0.25);
    }

    .scriptCalendar > tbody > tr > td {
        width: 50px;
        height: 70px;
        text-align: center;
        vertical-align: top;
        border: 1px solid rgba(0, 0, 0, 0.25);
    }

    .calendarBtn {
        cursor: pointer;
    }
</style>
<body>
<!-- warpper start -->
<div class="wrapper">
    <div th:replace="/layout/basic :: sidebar">

    </div>

    <!-- content start -->
    <div class="content">
        <div th:replace="/layout/basic :: navbar"></div>


            <div class="inner-content" style="margin: 2vw 0 0 6vh; max-width: 80%; display: flex" >
                <br>
                <div class="col-md-6" style="margin-left: auto; margin-right: 50px; margin-bottom: 50px;" >
                    <div class="row">
                        <h5>ê³µì§€ì‚¬í•­</h5>
                        <hr>
                        <div th:each="notice : ${noticeList}">
                            <div style="display: flex" class="align-items-center">
                                <div style="border-radius: 5px; border: solid #2a2d34 1px; max-width: 100px; display: inline-flex">
                                    <p style="margin: 5px"> [[${notice.categoryName}]]</p></div>
                                &nbsp;&nbsp;
                                <div th:text="${notice.title}"
                                     style="cursor: pointer; width: 65%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
                                     th:data="${notice.idx}" onclick="read(this.getAttribute('data'))"></div>
                                <div style="margin-left: auto;" th:text="${notice.writeDate}"></div>
                                <br>
                                <br>


                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <h5>ì¼ì •</h5>
                        <hr>
                        <table class="scriptCalendar">
                            <thead>
                            <tr>
                                <td class="calendarBtn" id="btnPrevCalendar">&#60;&#60;</td>
                                <td colspan="5" style="text-align: center">
                                    <span id="calYear">YYYY</span>ë…„
                                    <span id="calMonth">MM</span>ì›”
                                </td>
                                <td class="calendarBtn" id="nextNextCalendar">&#62;&#62;</td>
                            </tr>
                            <tr>
                                <td>ì¼</td>
                                <td>ì›”</td>
                                <td>í™”</td>
                                <td>ìˆ˜</td>
                                <td>ëª©</td>
                                <td>ê¸ˆ</td>
                                <td>í† </td>
                            </tr>
                            </thead>
                            <tbody th:each="lessonDate : ${lessonDate}"></tbody>
                        </table>

                    </div>
                </div>

                <div class="col-md-5" style="margin-right: auto;">
                    <div class="row">
                        <h5>ì§„í–‰ ì¤‘ì¸ ìˆ˜ì—…</h5>
                        <hr>

                        <div th:each="lesson : ${LessonList}">
                            <div style="display: flex" class="align-items-center">
                                <div style="border-radius: 5px; border: solid #2a2d34 1px; max-width: 100px; display: inline-flex">
                                    <p style="margin: 5px"> [[${lesson.curriculum.category.name}]]</p></div>
                                &nbsp;&nbsp;
                                <div class="lessonTitle" th:text="${lesson.curriculum.name}"
                                     th:data="${lesson.idx}"
                                     style="cursor: pointer; width: 65%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; "></div>
                                <div style="margin-left: auto;" th:text="${lesson.member.name}"></div>

                                <br>
                                <br>
                            </div>
                        </div>
                    </div>
                    <br>
                </div>
            </div>


            <!-- ìº˜ë¦°ë” ëª¨ë‹¬ -->
            <div class="modal calendarModal" tabindex="-1">
                <div class="modal-dialog" style="max-width: 60%;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title" style="font-weight:bold"></div>
                        </div>
                        <br>
                        <div>&nbsp;&nbsp;&nbsp;ê°œê°•</div>
                        <br>
                        <div class="startDay"></div>
                        <hr>
                        <div>&nbsp;&nbsp;&nbsp;ì¢…ê°•</div>
                        <br>
                        <div class="endDay"></div>
                        <br>
                        <div class="modal-footer"></div>
                    </div>
                </div>
            </div>
        </div>
</div>
<!-- content end -->


<!-- ì§„ì§œ ê°œ ì²œì²œíˆ topìœ¼ë¡œ ì˜¬ë¼ê°€ë„¤ìš”-->
<!--    ì¢€ ë¹ ë¥´ê²Œ ê³ ì¹¨ -->
<!-- ë” ë¹ ë¥´ê²Œ ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´ main.jsì—ì„œ back-to-top speed ì¡°ì • ë‚®ì„ìˆ˜ë¡ ë¹ ë¦„ -->
<a th:replace="/layout/basic :: back-to-top"></a>

</div>
<!-- wrapper end-->


<div th:replace="/layout/basic :: scriptSet">
</div>
<script src="/js/training.js"></script>
<script type="text/javascript">

    function read(idx) {
        location.href = "/member/notice/read?idx=" + idx;
    }

    const lessonTitle = document.querySelector(".lessonTitle");
    lessonTitle.addEventListener("click", function () {
        let idx = this.getAttribute("data");
        location.href = "/lesson/detail?idx=" + idx;
    })

    document.addEventListener("DOMContentLoaded", function () {
            buildCalendar();

            document.getElementById("btnPrevCalendar").addEventListener("click", function (event) {
                prevCalendar();
            });

            document.getElementById("nextNextCalendar").addEventListener("click", function (event) {
                nextCalendar();
            });
        }
    )
    ;

    var toDay = new Date(); // @param ì „ì—­ ë³€ìˆ˜, ì˜¤ëŠ˜ ë‚ ì§œ / ë‚´ ì»´í“¨í„° ë¡œì»¬ì„ ê¸°ì¤€ìœ¼ë¡œ toDayì— Date ê°ì²´ë¥¼ ë„£ì–´ì¤Œ
    var nowDate = new Date(); // @param ì „ì—­ ë³€ìˆ˜, ì‹¤ì œ ì˜¤ëŠ˜ë‚ ì§œ ê³ ì •ê°’

    /**
     * @brief ì´ì „ë‹¬ ë²„íŠ¼ í´ë¦­ì‹œ
     */
    function prevCalendar() {
        this.toDay = new Date(toDay.getFullYear(), toDay.getMonth() - 1, toDay.getDate());
        buildCalendar();    // @param ì „ì›” ìº˜ë¦°ë” ì¶œë ¥ ìš”ì²­
    }

    /**
     * @brief ë‹¤ìŒë‹¬ ë²„íŠ¼ í´ë¦­ì‹œ
     */
    function nextCalendar() {
        this.toDay = new Date(toDay.getFullYear(), toDay.getMonth() + 1, toDay.getDate());
        buildCalendar();    // @param ëª…ì›” ìº˜ë¦°ë” ì¶œë ¥ ìš”ì²­
    }

    /**
     * @brief ìº˜ë¦°ë” ì˜¤í”ˆ
     * @details ë‚ ì§œ ê°’ì„ ë°›ì•„ ìº˜ë¦°ë” í¼ì„ ìƒì„±í•˜ê³ , ë‚ ì§œê°’ì„ ì±„ì›Œë„£ëŠ”ë‹¤.
     */
    function buildCalendar() {

        let doMonth = new Date(toDay.getFullYear(), toDay.getMonth(), 1);
        let lastDate = new Date(toDay.getFullYear(), toDay.getMonth() + 1, 0);

        let tbCalendar = document.querySelector(".scriptCalendar > tbody");

        document.getElementById("calYear").innerText = toDay.getFullYear();                       // @param YYYYì›”
        document.getElementById("calMonth").innerText = autoLeftPad((toDay.getMonth() + 1), 2);   // @param MMì›”


        // @details ì´ì „ ìº˜ë¦°ë”ì˜ ì¶œë ¥ê²°ê³¼ê°€ ë‚¨ì•„ìˆë‹¤ë©´, ì´ì „ ìº˜ë¦°ë”ë¥¼ ì‚­ì œí•œë‹¤.
        while (tbCalendar.rows.length > 0) {
            tbCalendar.deleteRow(tbCalendar.rows.length - 1);
        }

        // @param ì²«ë²ˆì§¸ ê°œí–‰
        let row = tbCalendar.insertRow();

        // @param ë‚ ì§œê°€ í‘œê¸°ë  ì—´ì˜ ì¦ê°€ê°’
        let dom = 1;

        // @details ì‹œì‘ì¼ì˜ ìš”ì¼ê°’( doMonth.getDay() ) + í•´ë‹¹ì›”ì˜ ì „ì²´ì¼( lastDate.getDate())ì„  ë”í•´ì¤€ ê°’ì—ì„œ
        //  7ë¡œ ë‚˜ëˆˆê°’ì„ ì˜¬ë¦¼( Math.ceil() )í•˜ê³  ë‹¤ì‹œ ì‹œì‘ì¼ì˜ ìš”ì¼ê°’( doMonth.getDay() )ì„ ë¹¼ì¤€ë‹¤.
        let daysLength = (Math.ceil((doMonth.getDay() + lastDate.getDate()) / 7) * 7) - doMonth.getDay();

        // @param ë‹¬ë ¥ ì¶œë ¥
        // @details ì‹œì‘ê°’ì€ 1ì¼ì„ ì§ì ‘ ì§€ì •í•˜ê³  ìš”ì¼ê°’( doMonth.getDay() )ë¥¼ ë¹¼ì„œ ë§ˆì´ë„ˆìŠ¤( - )ë¡œ forë¬¸ì„ ì‹œì‘í•œë‹¤.
        for (let day = 1 - doMonth.getDay(); daysLength >= day; day++) {

            let column = row.insertCell();

            // @param í‰ì¼( ì „ì›”ì¼ê³¼ ìµì›”ì¼ì˜ ë°ì´í„° ì œì™¸ )
            if (Math.sign(day) == 1 && lastDate.getDate() >= day) {

                let today = toDay.getFullYear() + "-" + document.getElementById("calMonth").innerText + "-" + day;

                // @param í‰ì¼ ë‚ ì§œ ë°ì´í„° ì‚½ì…
                if (day < 10) {
                    today = toDay.getFullYear() + "-" + document.getElementById("calMonth").innerText + "-0" + day;
                }

                //ì—¬ê¸°ì—ì„œ training.js ì— findLessonDate ë¶ˆëŸ¬ì„œ if trueë©´ ì²´í¬ false ë©´ ê·¸ëƒ¥ ë‚ ì§œ ì¶œë ¥
                findLessonDate(today).then(result => {
                    if (result == true) {
                        console.log(today + " : " + result);
                        column.innerHTML = `${autoLeftPad(day, 2)}<br>ğŸ”µ`;
                    } else {
                        column.innerHTML = autoLeftPad(day, 2);
                    }
                })


                // @param ì¼ìš”ì¼ì¸ ê²½ìš°
                if (dom % 7 == 1) {
                    column.style.color = "#FF4D4D";
                }

                // @param í† ìš”ì¼ì¸ ê²½ìš°
                if (dom % 7 == 0) {
                    column.style.color = "#4D4DFF";
                    row = tbCalendar.insertRow();   // @param í† ìš”ì¼ì´ ì§€ë‚˜ë©´ ë‹¤ì‹œ ê°€ë¡œ í–‰ì„ í•œì¤„ ì¶”ê°€í•œë‹¤.
                }

            } //ë‚ ì§œ ë„£ê¸° END

            // @param í‰ì¼ ì „ì›”ì¼ê³¼ ìµì›”ì¼ì˜ ë°ì´í„° ë‚ ì§œë³€ê²½
            else {
                let exceptDay = new Date(doMonth.getFullYear(), doMonth.getMonth(), day);
                column.innerText = autoLeftPad(exceptDay.getDate(), 2);
                column.style.color = "#A9A9A9";
            }

            // @brief   ì „ì›”, ëª…ì›” ìŒì˜ì²˜ë¦¬
            // @details í˜„ì¬ë…„ê³¼ ì„ íƒ ë…„ë„ê°€ ê°™ì€ê²½ìš°
            if (toDay.getFullYear() == nowDate.getFullYear()) {

                // @details í˜„ì¬ì›”ê³¼ ì„ íƒì›”ì´ ê°™ì€ê²½ìš°
                if (toDay.getMonth() == nowDate.getMonth()) {

                    // @details í˜„ì¬ì¼ë³´ë‹¤ ì´ì „ì¸ ê²½ìš°ì´ë©´ì„œ í˜„ì¬ì›”ì— í¬í•¨ë˜ëŠ” ì¼ì¸ê²½ìš°
                    if (nowDate.getDate() > day && Math.sign(day) == 1) {
                        column.style.backgroundColor = "#FFFFFF";
                        column.style.cursor = "pointer";
                        column.onclick = function () {
                            calendarChoiceDay(this);
                        }
                    }

                    // @details í˜„ì¬ì¼ë³´ë‹¤ ì´í›„ì´ë©´ì„œ í˜„ì¬ì›”ì— í¬í•¨ë˜ëŠ” ì¼ì¸ê²½ìš°
                    else if (nowDate.getDate() < day && lastDate.getDate() >= day) {
                        column.style.backgroundColor = "#FFFFFF";
                        column.style.cursor = "pointer";
                        column.onclick = function () {
                            calendarChoiceDay(this);
                        }
                    }

                    // @details í˜„ì¬ì¼ì¸ ê²½ìš°
                    else if (nowDate.getDate() == day) {
                        column.style.backgroundColor = "rgba(188,214,255,0.25)";
                        column.style.cursor = "pointer";
                        column.onclick = function () {
                            calendarChoiceDay(this);
                        }
                    }

                    // @details í˜„ì¬ì›”ë³´ë‹¤ ì´ì „ì¸ê²½ìš°
                } else if (toDay.getMonth() < nowDate.getMonth()) {
                    if (Math.sign(day) == 1 && day <= lastDate.getDate()) {
                        column.style.backgroundColor = "#FFFFFF";
                        column.style.cursor = "pointer";
                        column.onclick = function () {
                            calendarChoiceDay(this);
                        }
                    }
                }

                // @details í˜„ì¬ì›”ë³´ë‹¤ ì´í›„ì¸ê²½ìš°
                else {
                    if (Math.sign(day) == 1 && day <= lastDate.getDate()) {
                        column.style.backgroundColor = "#FFFFFF";
                        column.style.cursor = "pointer";
                        column.onclick = function () {
                            calendarChoiceDay(this);
                        }
                    }
                }
            }

            // @details ì„ íƒí•œë…„ë„ê°€ í˜„ì¬ë…„ë„ë³´ë‹¤ ì‘ì€ê²½ìš°
            else if (toDay.getFullYear() < nowDate.getFullYear()) {
                if (Math.sign(day) == 1 && day <= lastDate.getDate()) {
                    column.style.backgroundColor = "#FFFFFF";
                    column.style.cursor = "pointer";
                    column.onclick = function () {
                        calendarChoiceDay(this);
                    }
                }
            }

            // @details ì„ íƒí•œë…„ë„ê°€ í˜„ì¬ë…„ë„ë³´ë‹¤ í°ê²½ìš°
            else {
                if (Math.sign(day) == 1 && day <= lastDate.getDate()) {
                    column.style.backgroundColor = "#FFFFFF";
                    column.style.cursor = "pointer";
                    column.onclick = function () {
                        calendarChoiceDay(this);
                    }
                }
            }
            dom++;
        } //param ë‹¬ë ¥ì¶œë ¥ END
    }

    /**
     * @brief ë‚ ì§œ ì„ íƒ
     * @details ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ ëª¨ë‹¬ ì°½ì´ ëœ¬ë‹¤.
     */

    const calendarModal = new bootstrap.Modal(document.querySelector(".calendarModal"))

    function calendarChoiceDay(column) {

        // ì„ íƒí•œ ë‚ ì§œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        var selectedDate = column.innerText.replace('ğŸ”µ', ''); // V ì œê±°í•œ ì¼ ë§Œ ê°€ì ¸ì˜¤ê¸°
        var calMonth = document.getElementById("calMonth").innerText
        var calYear = document.getElementById("calYear").innerText = toDay.getFullYear();

        // ëª¨ë‹¬ì˜ ì œëª©ê³¼ ë‚´ìš© ë³€ê²½
        const modalTitle = document.querySelector(".modal-title");
        modalTitle.textContent = calYear + " ë…„  " + calMonth + " ì›”   " + selectedDate + " ì¼";

        // ëª¨ë‹¬ ë³¸ë¬¸ ë‚´ìš©ì— í•´ë‹¹ ì¼ì˜ ì‹œì‘í•˜ëŠ” ìˆ˜ì—…ê³¼ ì¢…ë£Œí•˜ëŠ” ìˆ˜ì—… ì¶œë ¥
        const startDay = document.querySelector(".startDay");
        const endDay = document.querySelector(".endDay");

        // ê¸°ì¡´ì˜ ê°œê°•ìˆ˜ì—…ê³¼ ì¢…ê°•ìˆ˜ì—…ë“¤ì„ ì‚­ì œí•©ë‹ˆë‹¤.
        startDay.innerHTML = " ";
        endDay.innerHTML = " ";

        // today ì„¸íŒ… 0000-00-00 í˜•ì‹
        let today = calYear + "-" + calMonth + "-" + autoLeftPad(selectedDate, 2);

        calendarStartDay(today).then(result => {
            console.log(result[0].curriculum.name);
            result.forEach(lesson => {
                startDay.innerHTML += `<a href="/lesson/detail?idx=` + lesson.idx + `"> &nbsp;&nbsp;&nbsp;` + lesson.curriculum.name + lesson.number + `ê¸°</a><br><br>`;
            })
        })
        calendarEndDay(today).then(result => {
            console.log("ì¢…ê°•ì¼ : " + result);
            result.forEach(lesson => {
                endDay.innerHTML += `<a href="/lesson/detail?idx=` + lesson.idx + `"> &nbsp;&nbsp;&nbsp;` + lesson.curriculum.name + lesson.number + `ê¸°</a><br><br>`;
            })
        })

        // ëª¨ë‹¬ì„ ì—½ë‹ˆë‹¤.
        calendarModal.show();

        // ì„ íƒí•œ ë‚ ì§œì— í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        if (document.getElementsByClassName("choiceDay")[0]) {
            document.getElementsByClassName("choiceDay")[0].classList.remove("choiceDay");
        }
        column.classList.add("choiceDay");

    } // calendarChoiceDay END!!

    /**
     * @brief ìˆ«ì ë‘ìë¦¿ìˆ˜( 00 ) ë³€ê²½
     * @details ìë¦¿ìˆ˜ê°€ í•œìë¦¬ì¸ ( 1, 2, 3 ë“± )  ì˜ ê°’ì„ 10, 11, 12 ë“±ê³¼ ê°™ì€ ë‘ìë¦¬ìˆ˜ í˜•ì‹ìœ¼ë¡œ ë§ì¶”ê¸°ìœ„í•´ 0ì„ ë¶™ì¸ë‹¤.
     * @param num ì•ì— 0ì„ ë¶™ì¼ ìˆ«ì ê°’ * @param digit ê¸€ìì˜ ìë¦¿ìˆ˜ë¥¼ ì§€ì • ( 2ìë¦¿ìˆ˜ì¸ ê²½ìš° 00, 3ìë¦¿ìˆ˜ì¸ ê²½ìš° 000 â€¦ )
     */

    function autoLeftPad(num, digit
    ) {
        if (String(num).length < digit) {
            num = new Array(digit - String(num).length + 1).join("0") + num;
        }
        return num;
    }
</script>

</body>
</html>