<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head th:replace="/layout/basic :: head"></head>
<body>
<!-- wrapper start -->
<div class="wrapper">
    <div id="sidebar" th:replace="/layout/basic :: sidebar">

    </div>

    <!-- content start -->
    <div class="content">
        <div id="navbar" th:replace="/layout/basic :: navbar"></div>

        <div class="container-fluid pt-5 px-5">

            <div class="inner-content" style="margin: 2vw 0 0 6vh; max-width: 80%;">

                <h1>Survey Result</h1>



                <div class="row g-4" id="hidden_div">
                    <div class="col-sm-12 col-md-6 col-xl-4">
                        <button th:if="${round} == 1" class="btn btn-primary w-100 m-2 firstBtn" type="button" th:text="1회차">
                        </button>
                        <button th:if="${round} != 1" class="btn btn-outline-primary w-100 m-2 firstBtn" type="button" th:text="1회차">
                        </button>
                    </div>
                    <div class="col-sm-12 col-md-6 col-xl-4">
                        <button th:if="${round} == 2" class="btn btn-primary w-100 m-2 secondBtn" type="button" th:text="2회차">
                        </button>
                        <button th:if="${round} != 2" class="btn btn-outline-primary w-100 m-2 secondBtn" type="button" th:text="2회차">
                        </button>
                    </div>
                    <div class="col-sm-12 col-md-6 col-xl-4">
                        <button th:if="${round} == 3" class="btn btn-primary w-100 m-2 thirdBtn" type="button" th:text="3회차">
                        </button>
                        <button th:if="${round} != 3" class="btn btn-outline-primary w-100 m-2 thirdBtn" type="button" th:text="3회차">
                        </button>
                    </div>
                    <hr>
                    <button class="btn btn-primary" id="printBtn" type="button" th:text="인쇄하기">
                    </button>
                </div>
                <br>
                <div class="row g-4" id="print">
                    <div class="bg-light rounded h-100 p-4">
                        <h6>훈련과정 : [[ ${lesson.curriculum.name} ]]</h6>
                        <h6>훈련기간 : [[ ${lesson.startDay} ]] ~ [[ ${lesson.endDay} ]]</h6>
                        <h6>훈련회차 : [[ ${lesson.number} ]]회차</h6>
                        <h6>훈련교사 : [[ ${lesson.member.name} ]]</h6>
                        <h6>설문일자 : [[ ${lesson.survey1} ]]</h6>
                        <h6>설문회차 : [[ ${round} ]]회차</h6>
                    </div>

                    <hr>

                    <!-- 검색 -->
                    <div class="row mt-3 float-end" style="max-width: 500px; display: inline-flex">

                    </div>
                    <!-- 검색 끝-->

                    <!-- 설문 결과 그래프 -->
                    <div id="divide" th:each="i : ${#numbers.sequence(0, 19)}" style="page-break-inside: avoid;">
                        <div th:if="${surveyDTOList[i].content} != ''" class="bg-light rounded h-100 p-4" style="page-break-inside: avoid; max-width: 100%;">
                            <h6 class="mb-4" th:text="${surveyDTOList[i].number} + '.' + ${surveyDTOList[i].content}"></h6>
                            <div>
                                <th:block th:each="surveyAnswerDTO : ${surveyAnswerDTOList}">
                                    <div th:if="${not #strings.isEmpty(surveyAnswerDTO['com' + surveyDTOList[i].number])}">
                                        <div class="p-2 mb-2 bg-white text-dark" th:text="${surveyAnswerDTO['com' + surveyDTOList[i].number]}"></div>
                                    </div>
                                </th:block>
                            </div>
                            <div th:if="${surveyDTOList[i].type} == '객관식'">
                                <!-- 여기에 차트 생성 -->
                                <canvas th:id="'bar-chart-' + ${surveyDTOList[i].number}" style="max-width: 100%;"></canvas>
                            </div>
                        </div>
                    </div><!--반복문의 끝-->
                </div><!--end row g-4-->
                <br>
            </div>
            <!-- inner content end -->
        </div><!--end container-fluid pt-4 px-4-->
    </div>
    <!-- content end -->
    <div id="lessonIdx" hidden="hidden">[[${lesson.idx}]]</div>

    <!-- 진짜 개 천천히 top으로 올라가네요-->
    <!-- 좀 빠르게 고침 -->
    <!-- 더 빠르게 바꾸고 싶으면 main.js에서 back-to-top speed 조정 낮을수록 빠름 -->
    <a th:replace="/layout/basic :: back-to-top"></a>

</div>
<!-- wrapper end-->

<div th:replace="/layout/basic :: scriptSet">
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script id="surveyData" th:inline="javascript">
    /*<![CDATA[*/
    var surveyDTOList = /*[[${surveyDTOList}]]*/ [];
    var surveyResultDTOList = /*[[${surveyResultDTOList}]]*/ [];
    /*]]>*/
</script>

<script src="/js/member/lesson/survey/result.js"></script>

</body>
</html>
